{
  "Psoft": {
    "PsidePath": "psft_portable/pside.exe",
    "SqlPlusPath": "OracleClient/sqlplus.exe",
    "TempDir": "data/temp",
    "ReportDir": "data/reports",
    "ExportDir": "data/export",
    "BuildCfgPath": "cfg/ptbld.cfg",
    "ArgsManifestPath": "cfg/pside-args.json"
  },
  "StepChecks": {
    "TimeoutMs": 1200000,
    "ProbeMs": 20000,
    "PollMs": 5000, 
    "ByStep": {
      "CopyProject": {
        "dbRole": "source",
        "Sql": "SELECT CASE WHEN EXISTS ( SELECT 1 FROM PSPROJECTMSG a WHERE a.PROJECTNAME = UPPER('{Project}') AND a.MESSAGE_PARM2 = 'Copy' AND TO_TIMESTAMP(a.MESSAGE_PARM3 DEFAULT NULL ON CONVERSION ERROR, 'YYYY-MM-DD-HH24.MI.SS') > SYSTIMESTAMP - NUMTODSINTERVAL(300, 'SECOND') ) THEN 'PSFTAPI_READY' ELSE 'PSFTAPI_WAIT' END AS rc FROM dual;"

      },
        "Compare": {
          "dbRole": "source",
          "sql": "SELECT CASE WHEN EXISTS ( SELECT 1 FROM PSCOMPSESSION a  WHERE a.PROJECTNAME = UPPER('{Project}')  AND a.PTSESSIONID IN ( SELECT PTSESSIONID FROM  PSCOMPOBJDIFF a  )   AND a.RUNDTTM   > (SYSDATE - INTERVAL '300' SECOND)) THEN 'PSFTAPI_READY' ELSE 'PSFTAPI_WAIT'  END AS rc FROM dual;"
        },
        "Build": {
          "dbRole": "target",
          "sql": "\nWITH proj_tabs AS (\n  SELECT DISTINCT 'PS_' || UPPER(a.OBJECTVALUE1) AS name\n  FROM PSPROJECTITEM a\n  WHERE a.OBJECTTYPE IN (0)\n    AND a.PROJECTNAME = UPPER('{Project}')\n),\nexistence AS (\n  SELECT\n    (SELECT COUNT(*) FROM proj_tabs) AS proj_cnt,\n    (\n      SELECT COUNT(*)\n      FROM proj_tabs t\n      WHERE EXISTS (SELECT 1 FROM ALL_TABLES at WHERE at.TABLE_NAME = t.name)\n         OR EXISTS (SELECT 1 FROM ALL_VIEWS av WHERE av.VIEW_NAME = t.name)\n    ) AS exist_cnt\n  FROM dual\n)\nSELECT CASE\n         WHEN proj_cnt = 0           THEN 'PSFTAPI_READY'\n         WHEN exist_cnt = proj_cnt   THEN 'PSFTAPI_READY'\n         ELSE 'PSFTAPI_WAIT'\n       END AS rc\nFROM existence ;"
        },
        "EmptyContainer": {
          "dbRole": "target",
          "sql": "select case when exists (select 1 from PSPROJECTDEFN  a where a.PROJECTNAME = upper('{Project}')) THEN 'PSFTAPI_READY' ELSE 'PSFTAPI_WAIT'  END AS rc FROM dual;"
        }
      }
  }

}  



